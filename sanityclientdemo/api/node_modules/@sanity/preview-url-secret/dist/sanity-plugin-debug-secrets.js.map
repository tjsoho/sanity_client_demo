{"version":3,"file":"sanity-plugin-debug-secrets.js","sources":["../src/sanityPluginDebugSecrets/debugUrlSecrets.tsx","../src/sanityPluginDebugSecrets/index.ts"],"sourcesContent":["import {CheckmarkCircleIcon, CloseCircleIcon, LockIcon} from '@sanity/icons'\nimport {defineType} from 'sanity'\nimport {schemaType, SECRET_TTL} from '../constants'\n\nexport const debugUrlSecretsType = defineType({\n  type: 'document',\n  icon: LockIcon,\n  name: schemaType,\n  title: '@sanity/preview-url-secret',\n  readOnly: true,\n  fields: [\n    {\n      type: 'string',\n      name: 'secret',\n      title: 'Secret',\n    },\n    {\n      type: 'string',\n      name: 'source',\n      title: 'Source Tool',\n    },\n    {\n      type: 'string',\n      name: 'studioUrl',\n      title: 'Studio URL',\n    },\n    {\n      type: 'string',\n      name: 'userId',\n      title: 'Sanity User ID',\n    },\n  ],\n  preview: {\n    select: {\n      source: 'source',\n      studioUrl: 'studioUrl',\n      updatedAt: '_updatedAt',\n    },\n    prepare(data) {\n      const url = data.studioUrl ? new URL(data.studioUrl, location.origin) : undefined\n      const updatedAt = new Date(data.updatedAt).getTime()\n      const expiresAt = new Date(updatedAt + 1000 * SECRET_TTL)\n      const expired = expiresAt < new Date()\n      const icon = expired ? CloseCircleIcon : CheckmarkCircleIcon\n      return {\n        title: url ? `${url.host}${url.pathname}` : data.source,\n        subtitle: expired\n          ? 'Expired'\n          : `Expires in ${Math.round((expiresAt.getTime() - Date.now()) / (1000 * 60))} minutes`,\n        media: icon,\n      }\n    },\n  },\n})\n","import {definePlugin} from 'sanity'\nimport {schemaType} from '../constants'\nimport {debugUrlSecretsType} from './debugUrlSecrets'\n\nexport const debugSecrets = definePlugin<void>(() => {\n  return {\n    name: 'sanity-plugin-debug-secrets',\n    schema: {\n      types: [debugUrlSecretsType],\n    },\n    document: {\n      actions: (prev, context) => {\n        if (context.schemaType !== schemaType) {\n          return prev\n        }\n        return prev.filter(({action}) => action === 'delete')\n      },\n      inspectors: (prev, context) => {\n        if (context.documentType !== schemaType) {\n          return prev\n        }\n        return []\n      },\n      unstable_fieldActions: (prev, context) => {\n        if (context.schemaType.name !== schemaType) {\n          return prev\n        }\n        return []\n      },\n    },\n  }\n})\n"],"names":[],"mappings":"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"}