{"version":3,"file":"ViteDevServerStopped.mjs","sources":["../../src/core/studio/ViteDevServerStopped.tsx"],"sourcesContent":["/* eslint-disable i18next/no-literal-string -- will not support i18n in error boundaries */\nimport {Card, Container, Heading, Stack, Text} from '@sanity/ui'\nimport {type ReactNode, useCallback, useEffect, useState} from 'react'\nimport {type ViteHotContext} from 'vite/types/hot.js'\n\nconst ERROR_TITLE = 'Dev server stopped'\nconst ERROR_DESCRIPTION =\n  'The development server has stopped. You may need to restart it to continue working.'\n\nclass ViteDevServerStoppedError extends Error {\n  ViteDevServerStoppedError: boolean\n\n  constructor() {\n    super(ERROR_TITLE)\n    this.name = 'ViteDevServerStoppedError'\n    this.ViteDevServerStoppedError = true\n  }\n}\nconst serverHot = import.meta.hot\nconst isViteServer = (hot: unknown): hot is ViteHotContext => Boolean(hot)\n\nconst useDetectViteDevServerStopped = () => {\n  const [devServerStopped, setDevServerStopped] = useState(false)\n\n  const markDevServerStopped = useCallback(() => setDevServerStopped(true), [])\n\n  useEffect(() => {\n    // no early return to optimize tree-shaking\n    if (isViteServer(serverHot)) {\n      serverHot.on('vite:ws:disconnect', markDevServerStopped)\n    }\n  }, [markDevServerStopped])\n\n  return {devServerStopped}\n}\n\nconst ThrowViteServerStopped = () => {\n  const {devServerStopped} = useDetectViteDevServerStopped()\n\n  if (devServerStopped) throw new ViteDevServerStoppedError()\n\n  return null\n}\n\nexport const DetectViteDevServerStopped = (): ReactNode =>\n  isViteServer(serverHot) ? <ThrowViteServerStopped /> : null\n\nexport const DevServerStoppedErrorScreen = (): ReactNode => (\n  <Card\n    height=\"fill\"\n    overflow=\"auto\"\n    paddingY={[4, 5, 6, 7]}\n    paddingX={4}\n    sizing=\"border\"\n    tone=\"critical\"\n  >\n    <Container width={3}>\n      <Stack space={4}>\n        <Heading>{ERROR_TITLE}</Heading>\n\n        <Card border radius={2} overflow=\"auto\" padding={4} tone=\"inherit\">\n          <Stack space={4}>\n            <Text size={2}>{ERROR_DESCRIPTION}</Text>\n          </Stack>\n        </Card>\n      </Stack>\n    </Container>\n  </Card>\n)\n"],"names":[],"mappings":";;;AAKA,MAAM,cAAc,sBACd,oBACJ;AAEF,MAAM,kCAAkC,MAAM;AAAA,EAC5C;AAAA,EAEA,cAAc;AACZ,UAAM,WAAW,GACjB,KAAK,OAAO,6BACZ,KAAK,4BAA4B;AAAA,EACnC;AACF;AACA,MAAM,YAAY,YAAY,KACxB,eAAe,CAAC,QAAwC,CAAA,CAAQ,KAEhE,gCAAgC,MAAM;AAC1C,QAAM,CAAC,kBAAkB,mBAAmB,IAAI,SAAS,EAAK,GAExD,uBAAuB,YAAY,MAAM,oBAAoB,EAAI,GAAG,CAAE,CAAA;AAE5E,SAAA,UAAU,MAAM;AAEV,iBAAa,SAAS,KACxB,UAAU,GAAG,sBAAsB,oBAAoB;AAAA,KAExD,CAAC,oBAAoB,CAAC,GAElB,EAAC,iBAAgB;AAC1B,GAEM,yBAAyB,MAAM;AAC7B,QAAA,EAAC,qBAAoB;AAEvB,MAAA,iBAAwB,OAAA,IAAI;AAEzB,SAAA;AACT,GAEa,6BAA6B,MACxC,aAAa,SAAS,wBAAK,wBAAuB,CAAA,CAAA,IAAK,MAE5C,8BAA8B,MACzC;AAAA,EAAC;AAAA,EAAA;AAAA,IACC,QAAO;AAAA,IACP,UAAS;AAAA,IACT,UAAU,CAAC,GAAG,GAAG,GAAG,CAAC;AAAA,IACrB,UAAU;AAAA,IACV,QAAO;AAAA,IACP,MAAK;AAAA,IAEL,8BAAC,WAAU,EAAA,OAAO,GAChB,UAAC,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,MAAA,oBAAC,WAAS,UAAY,YAAA,CAAA;AAAA,MAEtB,oBAAC,QAAK,QAAM,IAAC,QAAQ,GAAG,UAAS,QAAO,SAAS,GAAG,MAAK,WACvD,UAAC,oBAAA,OAAA,EAAM,OAAO,GACZ,UAAA,oBAAC,QAAK,MAAM,GAAI,UAAkB,kBAAA,CAAA,EAAA,CACpC,EACF,CAAA;AAAA,IAAA,EAAA,CACF,EACF,CAAA;AAAA,EAAA;AACF;"}